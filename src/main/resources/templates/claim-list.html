<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--  <title>Track Claims</title>-->
<!--</head>-->
<!--<body>-->
<!--<h1>Your Claims</h1>-->
<!--<table>-->
<!--  <tr>-->
<!--    <th>ID</th>-->
<!--    <th>Description</th>-->
<!--    <th>Submission Date</th>-->
<!--    <th>Status</th>-->
<!--    <th>Actions</th>-->
<!--  </tr>-->
<!--  <tr th:each="claim : ${claims}">-->
<!--    <td th:text="${claim.id}"></td>-->
<!--    <td th:text="${claim.description}"></td>-->
<!--    <td th:text="${claim.submissionDate}"></td>-->
<!--    <td th:text="${claim.status}"></td>-->
<!--    <td>-->
<!--      <form th:if="${claim.status == 'PENDING'}" th:action="@{/claims/modify}" method="post">-->
<!--        <input type="hidden" name="id" th:value="${claim.id}"/>-->
<!--        <textarea name="description" th:text="${claim.description}"></textarea>-->
<!--        <input type="file" name="documents" multiple="multiple"/>-->
<!--        <button type="submit">Modify</button>-->
<!--      </form>-->
<!--      <form th:if="${claim.status == 'PENDING'}" th:action="@{/claims/withdraw}" method="post">-->
<!--        <input type="hidden" name="id" th:value="${claim.id}"/>-->
<!--        <button type="submit">Withdraw</button>-->
<!--      </form>-->
<!--    </td>-->
<!--  </tr>-->
<!--</table>-->
<!--</body>-->
<!--</html>-->




<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track Insurance Claims</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #2c3e50;
      --success-color: #2ecc71;
      --warning-color: #f39c12;
      --danger-color: #e74c3c;
      --light-bg: #f8f9fa;
    }

    body {
      background-color: #f5f7fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
    }

    .container {
      max-width: 1200px;
    }

    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .card-header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 1.5rem;
      border-bottom: none;
    }

    .status-badge {
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .status-pending {
      background-color: rgba(243, 156, 18, 0.1);
      color: var(--warning-color);
    }

    .status-approved {
      background-color: rgba(46, 204, 113, 0.1);
      color: var(--success-color);
    }

    .status-rejected {
      background-color: rgba(231, 76, 60, 0.1);
      color: var(--danger-color);
    }

    .status-processing {
      background-color: rgba(52, 152, 219, 0.1);
      color: var(--primary-color);
    }

    .claim-card {
      border-left: 4px solid var(--primary-color);
      transition: all 0.3s;
      margin-bottom: 1rem;
    }

    .claim-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 20px rgba(0, 0, 0, 0.1);
    }

    .claim-actions .btn {
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #6c757d;
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1.5rem;
      color: #dee2e6;
    }

    .filter-buttons .btn {
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .document-list {
      list-style-type: none;
      padding-left: 0;
    }

    .document-list li {
      padding: 0.5rem 0;
      border-bottom: 1px solid #eee;
    }

    .document-list li:last-child {
      border-bottom: none;
    }

    .document-list a {
      color: var(--primary-color);
      text-decoration: none;
    }

    .document-list a:hover {
      text-decoration: underline;
    }

    .stats-card {
      text-align: center;
      padding: 1.5rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
    }

    .stats-card i {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .stats-card.total {
      background-color: rgba(52, 152, 219, 0.1);
      color: var(--primary-color);
    }

    .stats-card.pending {
      background-color: rgba(243, 156, 18, 0.1);
      color: var(--warning-color);
    }

    .stats-card.approved {
      background-color: rgba(46, 204, 113, 0.1);
      color: var(--success-color);
    }

    .stats-card.rejected {
      background-color: rgba(231, 76, 60, 0.1);
      color: var(--danger-color);
    }

    .stats-number {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .stats-label {
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .modal-header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
    }

    @media (max-width: 768px) {
      .claim-actions .btn {
        width: 100%;
        margin-right: 0;
      }
    }
  </style>
</head>
<body>
<div class="container my-5">
  <div class="card">
    <div class="card-header">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h3 mb-0">Track Insurance Claims</h1>
          <p class="mb-0 opacity-75">View and manage your submitted insurance claims</p>
        </div>
        <a href="/claims/submit" class="btn btn-light">
          <i class="fas fa-plus me-2"></i>New Claim
        </a>
      </div>
    </div>

    <div class="card-body">
      <!-- Stats Overview -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="stats-card total">
            <i class="fas fa-file-alt"></i>
            <div class="stats-number" id="total-claims">5</div>
            <div class="stats-label">Total Claims</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card pending">
            <i class="fas fa-clock"></i>
            <div class="stats-number" id="pending-claims">2</div>
            <div class="stats-label">Pending</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card approved">
            <i class="fas fa-check-circle"></i>
            <div class="stats-number" id="approved-claims">2</div>
            <div class="stats-label">Approved</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card rejected">
            <i class="fas fa-times-circle"></i>
            <div class="stats-number" id="rejected-claims">1</div>
            <div class="stats-label">Rejected</div>
          </div>
        </div>
      </div>

      <!-- Filter Buttons -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="filter-buttons">
          <button class="btn btn-outline-primary active" data-filter="all">All Claims</button>
          <button class="btn btn-outline-warning" data-filter="pending">Pending</button>
          <button class="btn btn-outline-success" data-filter="approved">Approved</button>
          <button class="btn btn-outline-danger" data-filter="rejected">Rejected</button>
          <button class="btn btn-outline-info" data-filter="processing">Processing</button>
        </div>

        <div class="d-flex">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Search claims..." id="search-input">
            <button class="btn btn-outline-secondary" type="button">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Claims List -->
      <div id="claims-list">
        <!-- Claim items will be dynamically inserted here -->
      </div>

      <!-- Empty State -->
      <div id="empty-state" class="empty-state d-none">
        <i class="fas fa-folder-open"></i>
        <h3>No Claims Found</h3>
        <p>You haven't submitted any insurance claims yet.</p>
        <a href="/claims/submit" class="btn btn-primary mt-2">
          <i class="fas fa-plus me-2"></i>Submit Your First Claim
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Modify Claim Modal -->
<div class="modal fade" id="modifyClaimModal" tabindex="-1" aria-labelledby="modifyClaimModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modifyClaimModalLabel">Modify Claim</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="modify-claim-form">
          <input type="hidden" id="modify-claim-id">

          <div class="mb-3">
            <label for="modify-description" class="form-label">Description</label>
            <textarea class="form-control" id="modify-description" rows="5" required></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Upload Additional Documents</label>
            <div class="file-upload-area" id="modify-drop-area">
              <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-2"></i>
              <h6>Drag & Drop Files Here</h6>
              <p class="text-muted small">or click to browse</p>
              <p class="small text-muted">Supported formats: PDF, JPEG, PNG (Max 10MB per file)</p>
              <input type="file" id="modify-file-input" name="documents" multiple accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
            </div>

            <div class="file-list mt-3" id="modify-file-list"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="save-modifications">Save Changes</button>
      </div>
    </div>
  </div>
</div>

<!-- Withdraw Confirmation Modal -->
<div class="modal fade" id="withdrawClaimModal" tabindex="-1" aria-labelledby="withdrawClaimModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="withdrawClaimModalLabel">Withdraw Claim</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to withdraw this claim? This action cannot be undone.</p>
        <input type="hidden" id="withdraw-claim-id">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirm-withdraw">Withdraw Claim</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Sample claims data - in a real app, this would come from your backend
    const claims = [
      {
        id: 1,
        policyholderId: "PH-12345",
        description: "Car accident on Main Street. Rear-ended by another vehicle. No injuries reported.",
        submissionDate: "2023-10-15T14:30:00",
        status: "PENDING",
        documentPaths: ["accident_report.pdf", "car_damage1.jpg", "car_damage2.jpg"]
      },
      {
        id: 2,
        policyholderId: "PH-12345",
        description: "Water damage in kitchen due to pipe leak. Flooring and cabinets affected.",
        submissionDate: "2023-09-22T10:15:00",
        status: "APPROVED",
        documentPaths: ["plumber_report.pdf", "damage_photos.zip"]
      },
      {
        id: 3,
        policyholderId: "PH-12345",
        description: "Stolen laptop during business trip. Serial number: XPS-938472.",
        submissionDate: "2023-11-05T16:45:00",
        status: "PROCESSING",
        documentPaths: ["police_report.pdf", "purchase_receipt.jpg"]
      },
      {
        id: 4,
        policyholderId: "PH-12345",
        description: "Medical expenses for emergency room visit after allergic reaction.",
        submissionDate: "2023-08-30T09:20:00",
        status: "APPROVED",
        documentPaths: ["medical_bills.pdf", "doctor_report.pdf"]
      },
      {
        id: 5,
        policyholderId: "PH-12345",
        description: "Travel cancellation due to family emergency. Flight and hotel bookings.",
        submissionDate: "2023-07-12T11:05:00",
        status: "REJECTED",
        documentPaths: ["flight_tickets.pdf", "hotel_booking.pdf", "cancellation_reason.pdf"]
      }
    ];

    // DOM elements
    const claimsList = document.getElementById('claims-list');
    const emptyState = document.getElementById('empty-state');
    const filterButtons = document.querySelectorAll('.filter-buttons .btn');
    const searchInput = document.getElementById('search-input');

    // Modal elements
    const modifyClaimModal = new bootstrap.Modal(document.getElementById('modifyClaimModal'));
    const withdrawClaimModal = new bootstrap.Modal(document.getElementById('withdrawClaimModal'));

    // File upload elements for modify modal
    const modifyDropArea = document.getElementById('modify-drop-area');
    const modifyFileInput = document.getElementById('modify-file-input');
    const modifyFileList = document.getElementById('modify-file-list');
    let modifyUploadedFiles = [];

    // Initialize the page
    updateStats(claims);
    renderClaims(claims);

    // Filter functionality
    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Update active button
        filterButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');

        const filter = this.getAttribute('data-filter');
        filterClaims(filter);
      });
    });

    // Search functionality
    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      filterClaimsBySearch(searchTerm);
    });

    // File upload for modify modal
    modifyDropArea.addEventListener('click', function() {
      modifyFileInput.click();
    });

    modifyFileInput.addEventListener('change', function(e) {
      handleModifyFiles(e.target.files);
    });

    // Modify claim functionality
    document.getElementById('save-modifications').addEventListener('click', function() {
      const claimId = document.getElementById('modify-claim-id').value;
      const description = document.getElementById('modify-description').value;

      // In a real app, you would send this data to your backend
      console.log('Modifying claim:', {
        id: claimId,
        description: description,
        documents: modifyUploadedFiles
      });

      // Show success message
      alert('Claim updated successfully!');

      // Close modal and reset form
      modifyClaimModal.hide();
      resetModifyForm();

      // Refresh the claims list (in a real app, this would be done after API response)
      // For demo purposes, we'll just update the description in our local data
      const claimIndex = claims.findIndex(c => c.id == claimId);
      if (claimIndex !== -1) {
        claims[claimIndex].description = description;
        renderClaims(claims);
      }
    });

    // Withdraw claim functionality
    document.getElementById('confirm-withdraw').addEventListener('click', function() {
      const claimId = document.getElementById('withdraw-claim-id').value;

      // In a real app, you would send this request to your backend
      console.log('Withdrawing claim:', claimId);

      // Show success message
      alert('Claim withdrawn successfully!');

      // Close modal
      withdrawClaimModal.hide();

      // Update the claims list (in a real app, this would be done after API response)
      // For demo purposes, we'll just remove the claim from our local data
      const claimIndex = claims.findIndex(c => c.id == claimId);
      if (claimIndex !== -1) {
        claims.splice(claimIndex, 1);
        updateStats(claims);
        renderClaims(claims);
      }
    });

    // Functions
    function renderClaims(claimsToRender) {
      if (claimsToRender.length === 0) {
        claimsList.innerHTML = '';
        emptyState.classList.remove('d-none');
        return;
      }

      emptyState.classList.add('d-none');
      claimsList.innerHTML = '';

      claimsToRender.forEach(claim => {
        const claimElement = createClaimElement(claim);
        claimsList.appendChild(claimElement);
      });
    }

    function createClaimElement(claim) {
      const claimDiv = document.createElement('div');
      claimDiv.className = 'card claim-card';

      const statusClass = `status-${claim.status.toLowerCase()}`;
      const formattedDate = new Date(claim.submissionDate).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      // Create actions based on status
      let actionsHtml = '';
      if (claim.status === 'PENDING') {
        actionsHtml = `
                        <button class="btn btn-outline-primary btn-sm modify-claim" data-id="${claim.id}">
                            <i class="fas fa-edit me-1"></i>Modify
                        </button>
                        <button class="btn btn-outline-danger btn-sm withdraw-claim" data-id="${claim.id}">
                            <i class="fas fa-times me-1"></i>Withdraw
                        </button>
                    `;
      } else {
        actionsHtml = `
                        <button class="btn btn-outline-secondary btn-sm" disabled>
                            No actions available
                        </button>
                    `;
      }

      claimDiv.innerHTML = `
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="d-flex align-items-center mb-2">
                                    <h5 class="card-title mb-0 me-3">Claim #${claim.id}</h5>
                                    <span class="status-badge ${statusClass}">${claim.status}</span>
                                </div>
                                <p class="card-text">${claim.description}</p>
                                <div class="text-muted small">
                                    <i class="far fa-calendar me-1"></i>Submitted on ${formattedDate}
                                </div>
                                ${claim.documentPaths && claim.documentPaths.length > 0 ? `
                                <div class="mt-2">
                                    <strong>Documents:</strong>
                                    <ul class="document-list mt-1">
                                        ${claim.documentPaths.map(doc => `<li><a href="#"><i class="far fa-file me-1"></i>${doc}</a></li>`).join('')}
                                    </ul>
                                </div>
                                ` : ''}
                            </div>
                            <div class="col-md-4">
                                <div class="claim-actions text-md-end">
                                    ${actionsHtml}
                                    <button class="btn btn-outline-info btn-sm view-details" data-id="${claim.id}">
                                        <i class="fas fa-eye me-1"></i>View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

      // Add event listeners to action buttons
      const modifyBtn = claimDiv.querySelector('.modify-claim');
      if (modifyBtn) {
        modifyBtn.addEventListener('click', function() {
          openModifyModal(claim);
        });
      }

      const withdrawBtn = claimDiv.querySelector('.withdraw-claim');
      if (withdrawBtn) {
        withdrawBtn.addEventListener('click', function() {
          openWithdrawModal(claim.id);
        });
      }

      const viewDetailsBtn = claimDiv.querySelector('.view-details');
      if (viewDetailsBtn) {
        viewDetailsBtn.addEventListener('click', function() {
          alert(`Claim Details:\n\nID: ${claim.id}\nStatus: ${claim.status}\nSubmitted: ${formattedDate}\nDescription: ${claim.description}`);
        });
      }

      return claimDiv;
    }

    function filterClaims(filter) {
      if (filter === 'all') {
        renderClaims(claims);
      } else {
        const filteredClaims = claims.filter(claim =>
                claim.status.toLowerCase() === filter
        );
        renderClaims(filteredClaims);
      }
    }

    function filterClaimsBySearch(searchTerm) {
      if (!searchTerm) {
        renderClaims(claims);
        return;
      }

      const filteredClaims = claims.filter(claim =>
              claim.description.toLowerCase().includes(searchTerm) ||
              claim.id.toString().includes(searchTerm) ||
              claim.status.toLowerCase().includes(searchTerm)
      );

      renderClaims(filteredClaims);
    }

    function updateStats(claimsData) {
      const total = claimsData.length;
      const pending = claimsData.filter(c => c.status === 'PENDING').length;
      const approved = claimsData.filter(c => c.status === 'APPROVED').length;
      const rejected = claimsData.filter(c => c.status === 'REJECTED').length;

      document.getElementById('total-claims').textContent = total;
      document.getElementById('pending-claims').textContent = pending;
      document.getElementById('approved-claims').textContent = approved;
      document.getElementById('rejected-claims').textContent = rejected;
    }

    function openModifyModal(claim) {
      document.getElementById('modify-claim-id').value = claim.id;
      document.getElementById('modify-description').value = claim.description;

      // Reset file upload
      modifyUploadedFiles = [];
      modifyFileList.innerHTML = '';

      modifyClaimModal.show();
    }

    function openWithdrawModal(claimId) {
      document.getElementById('withdraw-claim-id').value = claimId;
      withdrawClaimModal.show();
    }

    function resetModifyForm() {
      document.getElementById('modify-claim-form').reset();
      modifyUploadedFiles = [];
      modifyFileList.innerHTML = '';
    }

    function handleModifyFiles(files) {
      for (let i = 0; i < files.length; i++) {
        const file = files[i];

        // Validate file type and size
        const validTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
        if (!validTypes.includes(file.type)) {
          alert(`File "${file.name}" is not a supported format. Please upload PDF, JPEG, or PNG files only.`);
          continue;
        }

        if (file.size > 10 * 1024 * 1024) { // 10MB limit
          alert(`File "${file.name}" exceeds the 10MB size limit.`);
          continue;
        }

        // Add to uploaded files
        modifyUploadedFiles.push(file);
        displayModifyFile(file);
      }
    }

    function displayModifyFile(file) {
      const fileItem = document.createElement('div');
      fileItem.className = 'file-item';

      const fileInfo = document.createElement('div');
      fileInfo.className = 'file-info';

      const fileIcon = document.createElement('i');
      fileIcon.className = 'file-icon fas fa-file-pdf';
      if (file.type.startsWith('image/')) {
        fileIcon.className = 'file-icon fas fa-file-image';
      }

      const fileName = document.createElement('span');
      fileName.className = 'file-name';
      fileName.textContent = file.name;

      const fileSize = document.createElement('span');
      fileSize.className = 'file-size';
      fileSize.textContent = formatFileSize(file.size);

      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-file';
      removeBtn.innerHTML = '<i class="fas fa-times"></i>';
      removeBtn.addEventListener('click', function() {
        const index = modifyUploadedFiles.indexOf(file);
        if (index > -1) {
          modifyUploadedFiles.splice(index, 1);
        }
        fileItem.remove();
      });

      fileInfo.appendChild(fileIcon);
      fileInfo.appendChild(fileName);
      fileInfo.appendChild(fileSize);

      fileItem.appendChild(fileInfo);
      fileItem.appendChild(removeBtn);

      modifyFileList.appendChild(fileItem);
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
  });
</script>
</body>
</html>